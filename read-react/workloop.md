## react-fiber work-loop

```javascript
/*                                                                                                                                                                                                                                            
 *                                                                                                                                                                                                                                            
 *                                                    ┌──────────────────────────┐                                                                                                                                                            
 *                                                    │unstable_scheduleCallback │◀──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────                                     
 *                                                    └─────────────┬────────────┘                                                                                                                      │                                     
 *                                                                  │                                                                                                                                   │                                     
 *                                                                  │                                                                                                                                   │                                     
 *                                                                  ▼                                                                                                                                   │                                     
 *                                                                 ╱ ╲                                                                                                                                  │                                     
 *                                                                ╱   ╲                                                                                                                                 │                                     
 *                                                         ┌───────────────┐            ┌──────────────────────────────┐                                                                                │                                     
 *                                                         │     delay     ├────true───▶│  push(timerQueue, newTask)   │                                                                                │                                     
 *                                                         └───────────────┘            └──────────────────────────────┘                                                                                │                                     
 *                                                                ╲   ╱                                                                                                                                 │                                     
 *                                                                 ╲ ╱                                                                                                                                  │                                     
 *                                                                  │                                                                                                                                   │                                     
 *                                                                  │                                                                                                                                   │                                     
 *                                                                  │                                                                                                                                   │                                     
 *                                                                  │                                                                                                                                   │                                     
 *                                                    ┌─────────────▼─────────────┐                                                                                                                     │                                     
 *                                                    │ push(taskQueue, newTask); │                                                                                                                     │                                     
 *                                                    └─────────────┬─────────────┘                                                                                                                     │                                     
 *                                                                  │                                                                                                                                   │                                     
 *                                                                  │                                     Λ                                                                                             │                                     
 *                                                                  │                                    ╱ ╲                                                                                            │                                     
 *                                                                  │                                   ╱   ╲                                                                                           │                                     
 *                                                    ┌─────────────▼──────────────┐             ┌────────────────────┐               ┌──────────────────────┐                                          │                                     
 *                                                    │    requestHostCallback     ◀─────────────┤      timeout       ◀───────────────│  requestHostTimeout  │◀─┐                                       │                                     
 *                                                    └─────────────┬──────────────┘             └────────────────────┘               └──────────────────────┘  │                                       │                                     
 *                                                                  │                                   ╲   ╱                                                   │                                       │                                     
 *                                                                  │                                    ╲ ╱                                                    │                                       │                                     
 *                                                   ┌──────────────▼───────────────┐                     V                                                     │                                       │                                     
 *                                     ┌────────────▶│         postMessage          │────────────────────┐                                                      │                                       │                                     
 *                                     │             └──────────────┬───────────────┘                    │                                                      │                                       │                                     
 *                                     │                            │                                    │                                                      │                                       │                                     
 *                                     │                     yeild to browser                            │                                                      │                                       │                                     
 *                                     │                            │                                    │                                                      │                                       │                                     
 *                                     │            ┌───────────────▼───────────────────┐                │                                                      │                                       │                                     
 *                                     │            │    browser work, when finidsh,    │                │                                                      │                                       │                                     
 *                                     │            │   it will call onmessage event    │                │                                                      │                                       │                                     
 *                                     │            └───────────────┬───────────────────┘                │                                                      │                                       │                                     
 *                                     │                            │                                    │                                                      │                                       │                                     
 *                                     │                yeild to javascript main thread                  │                                                      │                                       │                                     
 *                                     │                            │                                  true                                                     │                                       │                                     
 *                                     │          ┌─────────────────▼──────────────────┐                 │                                                      │                                       │                                     
 *                                     │          │ onmessage=performWorkUntilDeadline │                 │                                                      │                                       │                                     
 *                                     │          └─────────────────┬──────────────────┘                 │                                                      │                                       │                                     
 *                                     │                            │                                    │                                                      │                                       │                                     
 *                                     │                            ▼                                    │                                                      │                                       │                                     
 *                                     │                            Λ                                    │                                                      │                                       │                                     
 *                                     │                           ╱ ╲                                   │                                                      │                                       │                                     
 *                                     │                          ╱   ╲                                  │                                                      │                                       │                                     
 *                                     │          ┌──────────────────────────────────┐                   │                                                      │                                       │                                     
 *                                     │          │  scheduledHostCallback !== null  │                   │                                                      │                                       │                                     
 *                                     │          └──────────────────────────────────┘                   │                                                      │                                       │                                     
 *                                     │                          ╲   ╱                                  ▼                                                      │                                       │                                     
 *                                     │                           ╲ ╱                                   Λ                                                      │                                       │                                     
 *                                     │                            │                                   ╱ ╲                                                     │                                       │                                     
 *                                     │                            │                                  ╱   ╲                                                    │                                       │                                     
 *                                hasmorework                       │                                 ╱     ╲                   ┌──────────────────────────────┐│                                       │                                     
 *                                   true             ┌─────────────▼─────────────┐           ┌──────────────────────┐          │isMessageLoopRunning = false; ││                                       │                                     
 *                                     │              │   scheduledHostCallback   │──────────▶│     hasmorework      ├──false┬─▶│scheduledHostCallback = null; ││                                       │                                     
 *                                     │              └─────────────┬─────────────┘           └──────────────────────┘       │  └──────────────────────────────┘│                                       │                                     
 *                                     │                            │                                 ╲     ╱                │                                  │                                       │                                     
 *                                     │                            │                                  ╲   ╱                 │                                  │                                       │                                     
 *                                     │                            │                                   ╲ ╱                  │                                  │                                       │                                     
 *                                     │                            │                                    V                   │                                  │                                       │                                     
 *                                     │      ┌─────────────────────▼───────────────────────┐                                │                                  │                                       │                                     
 *                                     │      │  flushWork(hasTimeRemaining, initialTime)   │                                │                                  │                                       │                                     
 *                                     │      └─────────────────────┬───────────────────────┘                                │                                  │                                       │                                     
 *                                     │                            │                                                        │                                  │                                       │                                     
 *                                     │                            │                                                        │                                  │                                       │                                     
 *                                     │                            │                                                        │                                  │                                       │                                     
 *                                     │              ┌─────────────▼──────────────┐                                         │                                  │                                       │                                     
 *                                     │              │          workLoop          │                                         │                                  │                                       │                                     
 *                                     │              └─────────────┬──────────────┘                                         │                                  │                                       │                                     
 *                                     │                            │                                                        │                                  │                                       │                                     
 *                                     │                            │                                                        │                                  │                                       │                                     
 *                                     │                            │                                                        │                                  │                                       │                                     
 *                                     │             ┌──────────────▼──────────────┐                                         │                                  │                                       │                                     
 *                                     │             │        advanceTimers        │◀────────────┐                           │                                  │                                       │                                     
 *                                     │             └──────────────┬──────────────┘             │                           │                                  │                                       │                                     
 *                                     │                            │                            │                           │                                  │                                       │                                     
 *                                     │                            │                            │                           │                                  │                                       │                                     
 *                                     │                            │                            │                           │                                  │                                       │                                     
 *                                     │                            │                            │                           │                                  │                                       │                                     
 *                                     │             ┌──────────────▼──────────────┐             │                           │                                  │                                       │                                     
 *                                     │             │currentTask=peek(taskQueue); │             │                           │                                  │                                       │                                     
 *                                     │             └──────────────┬──────────────┘             │                           │                                  │                                       │                                     
 *                                     │                            │                            │                           │                                  │                                       │                                     
 *                                     │                            │                            │                   .───────────────.                          │                                       │                                     
 *                                     │                            ▼                            │             _.───'                 `────.                    │                                       │                                     
 *                                     │                           ╱ ╲                           │           ,'   ┌─────────────────────┐   `.                  │                                       │                                     
 *                                     │                          ╱   ╲                          │         ,'     │    return false     │     `.                │                                       │                                     
 *                                     │          ┌─────────────────────────────────────┐        │        ;       └─────────────────────┘       :               │                                       │                                     
 *                                     │          │        currentTask !== null         │────────┼────────:                                     ;               │                                       │                                     
 *                                     │          └─────────────────────────────────────┘        │         ╲       ┌─────────────────────┐     ╱                │                                       │                                     
 *                                     │                          ╲   ╱                          │          `.     │     timeQueue?      │──────────────────────┘                                       │                                     
 *                                     │                           ╲ ╱                           │            `.   └─────────────────────┘ ,'                                                           │                                     
 *                                     │                            │                            │              `────.               _.───'                                                             │                                     
 *                                     │                            │                            │                    `─────────────'                                                                   │                                     
 *                                     │                          true                           │                                                                                                      │                                     
 *                                     │                            │                            │                                                                                                      │                                     
 *                                     │                            ▼                            │                                                                                                      │                                     
 *                                     │                            Λ                            │                                                                                                      │                                     
 *                                     │                           ╱ ╲                           │                                                                                                      │                                     
 *                                     │  ┌────────────────────────────────────────────────┐     │                                                                                                      │                                     
 *                                     │  │   currentTask.expirationTime>currentTime &&    │     │                                                                                                      │                                     
 *                                     └──│   (!hasTimeRemaining || shouldYieldToHost())   │     │                                                                                                      │                                     
 *                                        └────────────────────────────────────────────────┘     │                                                                                                      │                                     
 *                                                                ╲   ╱                          │                                                                                                      │                                     
 *                                                                 ╲ ╱                           │                                                                                                      │                                     
 *                                                                  │                            │                                                                                                      │                                     
 *                                                                  │                            │                                                                                                      │                                     
 *                                                                  │                            │                                                                                                      │                                     
 *                                            ┌─────────────────────┼────────────────────────┐   │                                                                                                      │                                     
 *                                            │            continuat▼onCallback=             │   │                                                                                                      │                                     
 *                                            │       callback(didUserCallbackTimeout)       │───┼────────────────────────────┐                                                                         │                                     
 *                                            └──────────────────────┬───────────────────────┘   │                            │                                                                         │                                     
 *                                                                   │                           │                            │                                                                         │                                     
 *                                                                   │                           │                            │                                                                         │                                     
 *                                                                   │                           │                            │                                                                         │                                     
 *                                                                   ▼                           │                            │                                                                         │                                     
 *                                                                  ╱ ╲                          │                            │                                                                         │                                     
 *                                                 ┌─────────────────────────────────┐           │                            │                                                                         │                                     
 *                                                 │ continuationCallback===function │           │                            │                                                                         │                                     
 *                                                 │        means task finish        │──false────▶                            │                                                                         │                                     
 *                                                 └─────────────────────────────────┘           │                            │                                                                         │                                     
 *                                                                 ╲   ╱                         │                            │                                                                         │                                     
 *                                                                  ╲ ╱                          │                            │                                                                         │                                     
 *                                                                   │                           │                            │                                                                         │                                     
 *                                                                 true                          │                            │                                                                         │                                     
 *                                                                   │                           │                            │                                                                         │                                     
 *                                                                   │                           │                            │                                                                         │                                     
 *                                                  ┌────────────────▼────────────────────────┐  │                            │                                                                         │                                     
 *                                                  │             pop(taskQueue);             │──┘                            │                                                                         │                                     
 *                                                  └─────────────────────────────────────────┘                               │                                                                         │                                     
 *                                                                                                                            │                                                                         │                                     
 *                                                                                                                            │                                                                         │                                     
 *                                                                                                                            │                                                                         │                                     
 *                                                                                                                            │                                                                         │                                     
 *                                                                                                                            │                                                                         │                                     
 *                                                                                                                            │                                                                         │                                     
 *                                                                                                                            │                                                                         │                                     
 *                                                                                                                            ▼                                                                         │                                     
 *                                                                                                      ┌──────────────────────────────────────────┐                                                    │                                     
 *                                                                                                      │           performSyncWorkOnRoot          │                                                    │                                     
 *                                                                                                      └─────────────────────┬────────────────────┘                                                    │                                     
 *                                                                                                                            │                                                                         │                                     
 *                                                                                                                            │                                                                         │                                     
 *                                                                                                                            │                                                                         │                                     
 *                                                                                                                            │                                                                         │                                     
 *                                                                                                                            │                                                                         │                                     
 *                                                                                                                            │                                                                         │◀────────────────────────────────────
 *                                                                                                                ┌───────────▼──────────────┐                                                          │                                    │
 *                                                                                                                │      renderRootSync      │                                                          │                                    │
 *                                                                                                                └─────────────┬────────────┘                                                          │                                    │
 *                                                                                                                              │                                                                       │                                    │
 *                                                                                                                              │                                                                       │                                    │
 *                                                                                                                              │                                                                       │                                    │
 *                                                                                                                              │                                                                       │                                    │
 *                                                                                                                              │                                                                       │                                    │
 *                                                                                                                   ┌──────────▼────────────────────────────────────────────┐                          │                                    │
 *                                                                                                           ┌───────│                     workLoopSync                      │──────┐                   │                                    │
 *                                                                                                           │       └───────────────────────┬───────────────────────────────┘      │                   │                                    │
 *                                                                                                           │                               │                                      │                   │                                    │
 *                                                                                                           │                               │                                      │                   │                                    │
 *                                                                                                           │                               │                                      │                   │                                    │
 *                                                                                                           │                               ▼                                      │      ┌────────────────────────┐                        │
 *                                                                    ┌────────────────────────────────┐     │                   ┌─────────────────────────┐                        └──────▶ ensureRootIsScheduled  │                        │
 *                                                           ┌─────┬─▶│       performUnitOfWork        ◀─────┘                   │       commitRoot        │                               └────────────────────────┘                        │
 *                                                           │     │  └────────────────┬───────────────┘                         └──────────────┬──────────┘                                                                                 │
 *                                                           │     │                   │                                                        │                                                                                            │
 *                                                           │     │                   │                                                        │                                                                                            │
 *                                                           │     │                   │                                                        │                                                                                            │
 *                                                           │     │                   │                                    ┌───────────────────▼───────────────────────────────────────────────────────────┐                                │
 *                                                           │   true   ┌──────────────▼───────────────┐                    │                                runWithPriority                                │                                │
 *                                                           │     │    │   beginWork(current,....)    │                    └─────┬──────────────────────────────────────┬───────────────────────┬──────────┘                                │
 *                                                           │     │    └─────────────┬────────────────┘                          │                                      │                       │                                           │
 *                                                           │     │                  │                                           │                                      │                       │                                           │
 *                                                           │     │                  ▼                                           │                                      │                       │                                           │
 *                                                           │     │                  Λ                                           │                                      │                       │                                           │
 *                                                           │     │                 ╱ ╲                                          │                                      │                       │                                           │
 *                                                           │     │                ╱   ╲                       ┌─────────────────▼───────────┐              ┌───────────▼──────────┐   ┌────────▼───────────┐                               │
 *                                                           │     │     ┌────────────────────┐                 │ commitBeforeMutationEffects │              │commitMutationEffects │   │commitLayoutEffects │                               │
 *                                                           │     └─────│    next!==null     │                 └──────┬─────────────────┬────┘              └───────────┬──────────┘   └────────┬───────────┘                               │
 *                                                           │           └────────────────────┘                        │                 │                               │                       │                                           │
 *                                                           │                      ╲   ╱                              │                 │                               │                       │                                           │
 *                                                           │                       ╲ ╱                               │                 │                               │                       │                                           │
 *                                                           │                        V                                │                 │                               │                       ▼                                           │
 *                                                           │                        │                                │                 │                   ┌───────────▼───────┐   ┌──────────────────────┐                                │
 *                                                           │                    false                   ┌────────────▼────────────┐┌───▼────────────────┐  │     placement     │   │     layoutEffect     │                                │
 *                                                           │                        │                   │ getSnapshotBeforeUpdate ││flushPassiveEffects │  │  effect.destroy   │   │  componentDidMount   │                                │
 *                                                           │                        ▼                   └─────────────────────────┘└──────────┬─────────┘  │      unmount      │   │  componentDidUpdate  │                                │
 *                                                           │         ┌────────────────────────────┐                                           │            └───────────────────┘   └──────────────────────┘                                │
 *                                                           │      ┌─▶│     completeUnitOfWork     │◀─┐                                        │                                                                                            │
 *                                                           │      │  └────────────┬───────────────┘  │                                        │                                                                                            │
 *                                                           │      │               │                  │                                        │                                                                                            │
 *                                                           │      │               │                  │                                        │                                                                                            │
 *                                                           │      │               ▼                  │                                        │                                                                                            │
 *                                                           │    true              Λ                  │                                        │                                                                                            │
 *                                                           │      │              ╱ ╲                 │                                        │                                                                                            │
 *                                                           │      │             ╱   ╲                │                                        │                                                                                            │
 *                                                           │      │     ┌─────────────────────┐      │                                        │                                                                                            │
 *                                                           │      └─────│     next!==null     │      │                                        │                                                                                            │
 *                                                         true           └─────────────────────┘      │                                        │                                                                                            │
 *                                                           │                    ╲   ╱                │                                        ─────────────────────────────────────────────────────────────────────────────────────────────│
 *                                                           │                     ╲ ╱                 │                                                                                                                                      
 *                                                           │                      V                  │                                                                                                                                      
 *                                                           │                      │                  │                                                                                                                                      
 *                                                           │                    false                │                                                                                                                                      
 *                                                           │                      │                  │                                                                                                                                      
 *                                                           │                      ▼                  │                                                                                                                                      
 *                                                           │                     ╱ ╲                 │                                                                                                                                      
 *                                                           │                    ╱   ╲                │                                                                                                                                      
 *                                                           │  ┌──────────────────────────────────┐   │                                                                                                                                      
 *                                                           └──│       siblingFiber!==null        │   │                                                                                                                                      
 *                                                              └──────────────────────────────────┘   │                                                                                                                                      
 *                                                                                ╲   ╱                │                                                                                                                                      
 *                                                                                 ╲ ╱                 │                                                                                                                                      
 *                                                                                  │                  │                                                                                                                                      
 *                                                                                  │                  │                                                                                                                                      
 *                                                                                  │                  │                                                                                                                                      
 *                                                                                  │                  │                                                                                                                                      
 *                                                                                  ▼                  │                                                                                                                                      
 *                                                                                 ╱ ╲                 │                                                                                                                                      
 *                                                                                ╱   ╲                │                                                                                                                                      
 *                                                                    ┌──────────────────────────┐     │                                                                                                                                      
 *                                                                    │    returnFiber!==null    │─────┘                                                                                                                                      
 *                                                                    └──────────────────────────┘                                                                                                                                            
 *                                                                                ╲   ╱                                                                                                                                                       
 *                                                                                 ╲ ╱                                                                                                                                                        
 *                                                                                  V                                                                                                                                                         
 *                                                                                  │                                                                                                                                                         
 *                                                                                  │                                                                                                                                                         
 *                                                                       ┌──────────▼──────────┐                                                                                                                                              
 *                                                                       │         end         │                                                                                                                                              
 *                                                                       └─────────────────────┘                                                                                                                                              
 */                                                                                                                                                                                                                                           
```